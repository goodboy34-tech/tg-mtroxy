# MTProxy Management System

ะกะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั MTProto ะธ SOCKS5 ะฟัะพะบัะธ-ัะตัะฒะตัะฐะผะธ ัะตัะตะท Telegram ะฑะพั.

> **ะัะธะผะตัะฐะฝะธะต:** ะญัะพ ะฟะพะปะฝะพัััั ะฟะตัะตัะฐะฑะพัะฐะฝะฝะฐั ะฒะตััะธั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฝะพะดะฐะผะธ, ะฐ ะฝะต ะดะปั ะฟัะพะดะฐะถะธ ะดะพัััะฟะพะฒ.

## โจ ะัะพะฑะตะฝะฝะพััะธ

- ๐ค **ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท Telegram** - ะฒัะต ะพะฟะตัะฐัะธะธ ัะตัะตะท ะฑะพัะฐ
- ๐ **ะะฝะพะถะตััะฒะตะฝะฝัะต ะฝะพะดั** - ัะฟัะฐะฒะปะตะฝะธะต ะฝะตัะบะพะปัะบะธะผะธ ัะตัะฒะตัะฐะผะธ ะธะท ะพะดะฝะพะณะพ ะผะตััะฐ
- ๐ **ะขัะธ ัะธะฟะฐ ะฟัะพะบัะธ**:
  - MTProto ั Fake-TLS (dd) - ะพะฑัะพะด DPI ะฑะปะพะบะธัะพะฒะพะบ
  - MTProto ะพะฑััะฝัะน
  - SOCKS5 ัะฝะธะฒะตััะฐะปัะฝัะน
- ๐ณ **Docker everywhere** - ะฒัะต ะฒ ะบะพะฝัะตะนะฝะตัะฐั
- ๐ **mTLS ะฐััะตะฝัะธัะธะบะฐัะธั** - ะฑะตะทะพะฟะฐัะฝะฐั ัะฒัะทั ะผะตะถะดั Control Panel ะธ ะฝะพะดะฐะผะธ
- ๐ **ะะพะฝะธัะพัะธะฝะณ** - ััะฐัะธััะธะบะฐ, ะปะพะณะธ, ะทะดะพัะพะฒัะต ะฝะพะด
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะฐั ัััะฐะฝะพะฒะบะฐ** - ัะบัะธะฟัั setup ะดะตะปะฐัั ะฒัะต ะทะฐ ะฒะฐั
- ๐ **ะะพะบะฐะปัะฝัะน ะฟัะพะบัะธ** - ะฒะพะทะผะพะถะฝะพััั ะฟะพะดะบะปััะตะฝะธั ั ัะตัะฒะตัะฐ Control Panel

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Control Panel (Docker Compose)        โ
โ   โโโ Telegram Bot (ัะฟัะฐะฒะปะตะฝะธะต)         โ
โ   โโโ API Server (ัะฒัะทั ั ะฝะพะดะฐะผะธ)       โ
โ   โโโ SQLite Database                    โ
โ   โโโ Local Proxy (ะพะฟัะธะพะฝะฐะปัะฝะพ)         โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ mTLS / Token Auth
        โโโโโโโโโโโดโโโโโโโโโโฌโโโโโโโโโโโโโโโ
        โ                   โ              โ
โโโโโโโโโผโโโโโโโโโ  โโโโโโโโโผโโโโโโโโโ   ...
โ  Node 1        โ  โ  Node 2        โ
โ  โโโ Node API  โ  โ  โโโ Node API  โ
โ  โโโ MTProto   โ  โ  โโโ MTProto   โ
โ  โ   (dd+norm) โ  โ  โ   (dd+norm) โ
โ  โโโ SOCKS5    โ  โ  โโโ SOCKS5    โ
โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### Control Panel (ะณะปะฐะฒะฝัะน ัะตัะฒะตั)

```bash
git clone <repo-url>
cd tg-mtproxy
chmod +x scripts/*.sh
sudo ./scripts/setup-control.sh
```

ะะฐัััะพะนัะต `.env` ะธ ะทะฐะฟัััะธัะต:

```bash
sudo systemctl start mtproxy-control
```

### Node Agent (ะฝะฐ ะบะฐะถะดะพะน ะฝะพะดะต)

ะกะบะพะฟะธััะนัะต ัะฐะนะปั ะธ ะทะฐะฟัััะธัะต:

```bash
chmod +x scripts/setup-node.sh
sudo ./scripts/setup-node.sh
```

ะะพะฑะฐะฒััะต ะฝะพะดั ัะตัะตะท ะฑะพัะฐ ะบะพะผะฐะฝะดะพะน `/add_node`.

## ๐ ะะพะบัะผะตะฝัะฐัะธั

ะะพะปะฝะฐั ะธะฝััััะบัะธั: [INSTALL.md](INSTALL.md)

## ๐ค ะะพะผะฐะฝะดั ะฑะพัะฐ

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฝะพะดะฐะผะธ
- `/nodes` - ัะฟะธัะพะบ ะฒัะตั ะฝะพะด
- `/add_node` - ะดะพะฑะฐะฒะธัั ะฝะพะฒัั ะฝะพะดั  
- `/node <id>` - ะธะฝัะพัะผะฐัะธั ะพ ะฝะพะดะต
- `/remove_node <id>` - ัะดะฐะปะธัั ะฝะพะดั
- `/restart_node <id>` - ะฟะตัะตะทะฐะฟัััะธัั ะฟัะพะบัะธ

### ะะพะปััะตะฝะธะต ะดะพัััะฟะพะฒ
- `/links <node_id>` - ะฟะพะปััะธัั ะฒัะต ัััะปะบะธ (MTProto dd, MTProto, SOCKS5)
- `/add_secret <node_id>` - ะดะพะฑะฐะฒะธัั MTProto ัะตะบัะตั
- `/add_socks5 <node_id>` - ะดะพะฑะฐะฒะธัั SOCKS5 ะฐะบะบะฐัะฝั

### ะะพะฝะธัะพัะธะฝะณ
- `/stats` - ะพะฑัะฐั ััะฐัะธััะธะบะฐ
- `/health` - ะทะดะพัะพะฒัะต ะฒัะตั ะฝะพะด
- `/logs <node_id>` - ะปะพะณะธ ะฝะพะดั

### ะะฐัััะพะนะบะธ
- `/set_workers <node_id> <count>` - ัััะฐะฝะพะฒะธัั ะบะพะปะธัะตััะฒะพ ะฒะพัะบะตัะพะฒ

## ๐ ะะพะบะฐะปัะฝัะน ะฟัะพะบัะธ

ะะบะปััะธัั ะฟัะพะบัะธ ะฝะฐ ัะตัะฒะตัะต Control Panel:

```bash
# ะ .env ัััะฐะฝะพะฒะธัะต
LOCAL_PROXY_ENABLED=true

# ะฃะฟัะฐะฒะปะตะฝะธะต
./scripts/local-proxy.sh start
./scripts/local-proxy.sh links
./scripts/local-proxy.sh status
```

## ๐ ะะพะทะผะพะถะฝะพััะธ MTProto

### Fake-TLS (dd ะฟัะตัะธะบั)
- ะะพะฑะฐะฒะปัะตั ัะปััะฐะนะฝัะน padding ะบ ะฟะฐะบะตัะฐะผ
- ะะฑัะพะดะธั DPI (Deep Packet Inspection)
- ะะตะบะพะผะตะฝะดัะตััั ะดะปั ัััะฐะฝ ั ะฑะปะพะบะธัะพะฒะบะฐะผะธ
- ะะบะปััะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะฒัะฑะพัะต "Fake-TLS" ะฒ ะฑะพัะต

### ะะพัะบะตัั (Workers)
- ะะดะธะฝ ะฒะพัะบะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะพ 60,000 ะฟะพะดะบะปััะตะฝะธะน
- ะะตะบะพะผะตะฝะดัะตััั: ะฟะพ ะบะพะปะธัะตััะฒั CPU ัะดะตั
- ะะฐัััะฐะธะฒะฐะตััั ัะตัะตะท `WORKERS` ะฒ `.env` ะธะปะธ ัะตัะตะท ะฑะพัะฐ

### ะะพะผะตะฝั ัะตัะตะท NAT
- ะะฒัะพะผะฐัะธัะตัะบะธะน mapping: ะฒะฝัััะตะฝะฝะธะน IP โ ะฒะฝะตัะฝะธะน ะดะพะผะตะฝ
- ะะฐัััะฐะธะฒะฐะตััั ัะตัะตะท `INTERNAL_IP` ะธ `DOMAIN` ะฒ `.env`
- MTProto ะธัะฟะพะปัะทัะตั `--nat-info` ะดะปั ะฟัะฐะฒะธะปัะฝะพะน ัะฐะฑะพัั

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### mTLS (Mutual TLS)
- ะะทะฐะธะผะฝะฐั ะฐััะตะฝัะธัะธะบะฐัะธั ะผะตะถะดั Control Panel ะธ ะฝะพะดะฐะผะธ
- ะะฒัะพะผะฐัะธัะตัะบะฐั ะณะตะฝะตัะฐัะธั ัะตััะธัะธะบะฐัะพะฒ
- ะะปััะตัะฝะฐัะธะฒะฐ: Bearer Token (ะตัะปะธ mTLS ะฝะต ะฝัะถะตะฝ)

### API Token
- ะะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ัััะฐะฝะพะฒะบะต ะฝะพะดั
- 64-ัะธะผะฒะพะปัะฝัะน hex ัะพะบะตะฝ
- ะะตัะตะดะฐะตััั ะฒ ะทะฐะณะพะปะพะฒะบะต `Authorization: Bearer`

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
tg-mtproxy/
โโโ src/                      # Control Panel ะธััะพะดะฝะธะบะธ
โ   โโโ index.ts             # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โโโ bot.ts               # Telegram ะฑะพั
โ   โโโ database.ts          # ะะฐะทะฐ ะดะฐะฝะฝัั (SQLite)
โ   โโโ node-client.ts       # ะะปะธะตะฝั ะดะปั ะฒะทะฐะธะผะพะดะตะนััะฒะธั ั ะฝะพะดะฐะผะธ
โ
โโโ node-agent/              # Node Agent (ะดะปั ะฝะพะด)
โ   โโโ src/
โ   โ   โโโ api.ts          # API ัะตัะฒะตั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟัะพะบัะธ
โ   โโโ Dockerfile
โ   โโโ package.json
โ
โโโ scripts/                 # ะกะบัะธะฟัั ัััะฐะฝะพะฒะบะธ ะธ ัะฟัะฐะฒะปะตะฝะธั
โ   โโโ setup-control.sh    # ะฃััะฐะฝะพะฒะบะฐ Control Panel
โ   โโโ setup-node.sh       # ะฃััะฐะฝะพะฒะบะฐ Node Agent
โ   โโโ generate-certs.sh   # ะะตะฝะตัะฐัะธั mTLS ัะตััะธัะธะบะฐัะพะฒ
โ   โโโ local-proxy.sh      # ะฃะฟัะฐะฒะปะตะฝะธะต ะปะพะบะฐะปัะฝัะผ ะฟัะพะบัะธ
โ
โโโ docker-compose.yml       # Control Panel + Local Proxy
โโโ docker-compose.node.yml  # Node Agent + MTProto + SOCKS5
โ
โโโ .env.control.example     # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ Control Panel
โโโ .env.node.example        # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ Node Agent
โ
โโโ INSTALL.md              # ะะพะปะฝะฐั ะธะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต
โโโ README.md               # ะญัะพั ัะฐะนะป
```

## ๐๏ธ ะขัะตะฑะพะฒะฐะฝะธั

### Control Panel
- Ubuntu 20.04+ / Debian 11+
- 1 GB RAM (ะผะธะฝะธะผัะผ)
- Docker ะธ Docker Compose
- Node.js 20+ (ะดะปั ัะฐะทัะฐะฑะพัะบะธ, ะพะฟัะธะพะฝะฐะปัะฝะพ)

### Node Agent (ะฝะฐ ะบะฐะถะดะพะน ะฝะพะดะต)
- Ubuntu 20.04+ / Debian 11+
- 1 GB+ RAM (ะทะฐะฒะธัะธั ะพั ะฝะฐะณััะทะบะธ)
- 1+ CPU ัะดัะฐ
- Docker ะธ Docker Compose
- ะัะบััััะต ะฟะพััั: 443 (MTProto), 1080 (SOCKS5), 8080 (API)

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะงะตัะตะท ะฑะพัะฐ
- `/stats` - ััะฐัะธััะธะบะฐ ะฒัะตั ะฝะพะด
- `/health` - ะทะดะพัะพะฒัะต ะฝะพะด
- `/node <id>` - ะดะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ะฝะพะดะต

### ะะพะณะธ
```bash
# Control Panel
sudo journalctl -u mtproxy-control -f

# Node Agent
sudo journalctl -u mtproxy-node -f

# Docker ะบะพะฝัะตะนะฝะตัั
docker logs -f mtproxy
docker logs -f mtproxy-socks5
```

### API ัะฝะดะฟะพะธะฝัั (Node Agent)
- `GET /health` - ะทะดะพัะพะฒัะต ะฝะพะดั
- `GET /stats` - ััะฐัะธััะธะบะฐ MTProto ะธ SOCKS5
- `GET /ping` - ะฟัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ

## ๐ ะะฑะฝะพะฒะปะตะฝะธะต

### Control Panel
```bash
cd /path/to/tg-mtproxy
git pull
npm install
npm run build
sudo systemctl restart mtproxy-control
```

### Node Agent
```bash
# ะกะบะพะฟะธััะนัะต ะพะฑะฝะพะฒะปะตะฝะฝัะต ัะฐะนะปั ั Control Panel
scp -r root@control:/path/to/tg-mtproxy/node-agent/* ./node-agent/
cd node-agent
npm install
npm run build
sudo systemctl restart mtproxy-node
```

## ๐ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะะพั ะฝะต ะพัะฒะตัะฐะตั
1. ะัะพะฒะตัััะต `.env` (BOT_TOKEN ะธ ADMIN_IDS)
2. ะัะพะฒะตัััะต ะปะพะณะธ: `sudo journalctl -u mtproxy-control -n 50`
3. ะัะพะฒะตัััะต ััะพ ะบะพะฝัะตะนะฝะตั ะทะฐะฟััะตะฝ: `docker ps`

### ะะพะดะฐ ะฝะต ะฟะพะดะบะปััะฐะตััั
1. ะัะพะฒะตัััะต API Token
2. ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั: `curl -H "Authorization: Bearer TOKEN" https://node:8080/ping`
3. ะัะพะฒะตัััะต ัะฐะนัะฒะพะป: `sudo ufw status`
4. ะัะพะฒะตัััะต ะปะพะณะธ ะฝะพะดั: `docker logs mtproxy-node-agent`

### MTProto ะฝะต ัะฐะฑะพัะฐะตั
1. ะะฑะฝะพะฒะธัะต proxy-secret: ัะตัะตะท API `/system/update-proxy-files`
2. ะัะพะฒะตัััะต ะฟะพััั: `sudo netstat -tulpn | grep 443`
3. ะัะพะฒะตัััะต ะปะพะณะธ: `docker logs mtproxy`

## ๐ก ะกะพะฒะตัั

1. **ะะตะณะธัััะธััะนัะต ะฟัะพะบัะธ ั @MTProxybot** ะดะปั ะฟะพะปััะตะฝะธั ััะฐัะธััะธะบะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
2. **ะะฑะฝะพะฒะปัะนัะต proxy-secret ัะฐะท ะฒ ะดะตะฝั** (ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท cron)
3. **ะัะฟะพะปัะทัะนัะต Fake-TLS (dd)** ะดะปั ัััะฐะฝ ั ะฑะปะพะบะธัะพะฒะบะฐะผะธ
4. **ะะฐัััะฐะธะฒะฐะนัะต ะฒะพัะบะตัั** ะฟะพ ะบะพะปะธัะตััะฒั CPU ัะดะตั
5. **ะะพะฝะธัะพัััะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ** ัะตัะตะท `/stats`
6. **ะะตะปะฐะนัะต ะฑัะบะฐะฟั** ะฑะฐะทั ะดะฐะฝะฝัั: `data/proxy.db`

## ๐ ะะพะดะดะตัะถะบะฐ

- ๐ [ะะพะปะฝะฐั ะธะฝััััะบัะธั](INSTALL.md)
- ๐ [Issues](https://github.com/your-repo/issues)
- ๐ฌ Telegram: @your_support_channel

## ๐ ะะธัะตะฝะทะธั

MIT License

---

**ะกะดะตะปะฐะฝะพ ั โค๏ธ ะดะปั ะพะฑัะพะดะฐ ะฑะปะพะบะธัะพะฒะพะบ Telegram**

ะกะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั MTProto ะธ SOCKS5 ะฟัะพะบัะธ-ัะตัะฒะตัะฐะผะธ ัะตัะตะท Telegram ะฑะพั.

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Control Panel (Docker Compose)        โ
โ   โโโ Telegram Bot (ัะฟัะฐะฒะปะตะฝะธะต)         โ
โ   โโโ API Server (ัะฒัะทั ั ะฝะพะดะฐะผะธ)       โ
โ   โโโ SQLite Database                    โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ mTLS / Token Auth
        โโโโโโโโโโโดโโโโโโโโโโฌโโโโโโโโโโโโโโโ
        โ                   โ              โ
โโโโโโโโโผโโโโโโโโโ  โโโโโโโโโผโโโโโโโโโ   ...
โ  Node 1        โ  โ  Node 2        โ
โ  โโโ Node API  โ  โ  โโโ Node API  โ
โ  โโโ MTProto   โ  โ  โโโ MTProto   โ
โ  โ   - dd      โ  โ  โ   - dd      โ
โ  โ   - normal  โ  โ  โ   - normal  โ
โ  โโโ SOCKS5    โ  โ  โโโ SOCKS5    โ
โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ
```

## ะะพะทะผะพะถะฝะพััะธ

### Control Panel (ะณะปะฐะฒะฝัะน ัะตัะฒะตั)
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฝะพะดะฐะผะธ ัะตัะตะท Telegram ะฑะพั
- ะะพะฑะฐะฒะปะตะฝะธะต/ัะดะฐะปะตะฝะธะต/ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฝะพะด
- ะะตะฝะตัะฐัะธั ัะตะบัะตัะพะฒ ะดะปั MTProto
- ะะพะปััะตะฝะธะต ัััะปะพะบ ะดะปั ะฟะพะดะบะปััะตะฝะธั (3 ัะธะฟะฐ)
- ะะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั ะฝะพะด
- ะัะพัะผะพัั ััะฐัะธััะธะบะธ

### Node Agent (ะฝะฐ ะบะฐะถะดะพะน ะฝะพะดะต)
- API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟัะพะบัะธ
- MTProto Proxy:
  - Fake-TLS (dd ะฟัะตัะธะบั) ะดะปั ะพะฑัะพะดะฐ DPI
  - ะะฑััะฝัะน MTProto
  - ะะฐัััะพะนะบะฐ ะบะพะปะธัะตััะฒะฐ ะฒะพัะบะตัะพะฒ
  - ะะพะดะดะตัะถะบะฐ ะดะพะผะตะฝะพะฒ (NAT mapping)
  - ะะฝะพะถะตััะฒะตะฝะฝัะต ัะตะบัะตัั
- SOCKS5 Proxy
- ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะพะฝะธัะพัะธะฝะณ ะธ ััะฐัะธััะธะบะฐ

## ะขะธะฟั ะฟัะพะบัะธ

ะะฐะถะดะฐั ะฝะพะดะฐ ะฟัะตะดะพััะฐะฒะปัะตั 3 ัะธะฟะฐ ะฟะพะดะบะปััะตะฝะธั:

1. **MTProto ั Fake-TLS (dd)** - ะดะปั ะพะฑัะพะดะฐ DPI ะฑะปะพะบะธัะพะฒะพะบ
   ```
   tg://proxy?server=domain.com&port=443&secret=dd<hex_secret>
   ```

2. **MTProto ะพะฑััะฝัะน** - ััะฐะฝะดะฐััะฝัะน ะฟัะพัะพะบะพะป
   ```
   tg://proxy?server=domain.com&port=443&secret=<hex_secret>
   ```

3. **SOCKS5** - ัะฝะธะฒะตััะฐะปัะฝัะน ะฟัะพะบัะธ
   ```
   socks5://user:pass@domain.com:1080
   ```

## ะะพะผะฐะฝะดั ะฑะพัะฐ

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฝะพะดะฐะผะธ
- `/nodes` - ัะฟะธัะพะบ ะฒัะตั ะฝะพะด
- `/add_node` - ะดะพะฑะฐะฒะธัั ะฝะพะฒัั ะฝะพะดั
- `/remove_node <id>` - ัะดะฐะปะธัั ะฝะพะดั
- `/node_info <id>` - ะธะฝัะพัะผะฐัะธั ะพ ะฝะพะดะต
- `/restart_node <id>` - ะฟะตัะตะทะฐะฟัััะธัั ะฟัะพะบัะธ ะฝะฐ ะฝะพะดะต

### ะะพะปััะตะฝะธะต ะดะพัััะฟะพะฒ
- `/get_links <node_id>` - ะฟะพะปััะธัั ะฒัะต ัััะปะบะธ ะดะปั ะฝะพะดั
- `/generate_secret` - ัะณะตะฝะตัะธัะพะฒะฐัั ะฝะพะฒัะน ัะตะบัะตั

### ะะพะฝะธัะพัะธะฝะณ
- `/stats` - ะพะฑัะฐั ััะฐัะธััะธะบะฐ
- `/node_stats <id>` - ััะฐัะธััะธะบะฐ ะบะพะฝะบัะตัะฝะพะน ะฝะพะดั
- `/health` - ะทะดะพัะพะฒัะต ะฒัะตั ะฝะพะด

### ะะฐัััะพะนะบะธ
- `/set_workers <node_id> <count>` - ัััะฐะฝะพะฒะธัั ะบะพะปะธัะตััะฒะพ ะฒะพัะบะตัะพะฒ
- `/set_domain <node_id> <domain>` - ะธะทะผะตะฝะธัั ะดะพะผะตะฝ ะฝะพะดั

## ะฃััะฐะฝะพะฒะบะฐ

### Control Panel (ะณะปะฐะฒะฝัะน ัะตัะฒะตั)

1. ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน:
```bash
git clone <repo>
cd tg-mtproxy
```

2. ะะฐัััะพะธัั `.env`:
```bash
cp .env.example .env
nano .env
```

3. ะะฐะฟัััะธัั:
```bash
docker-compose up -d
```

### Node Agent (ะฝะฐ ะบะฐะถะดะพะน ะฝะพะดะต)

1. ะกะบะพะฟะธัะพะฒะฐัั ัะฐะนะปั ะฝะพะดั:
```bash
scp -r node/* user@node-server:~/mtproxy-node/
```

2. ะะฐัััะพะธัั `.env` ะฝะฐ ะฝะพะดะต:
```bash
nano .env
```

3. ะะฐะฟัััะธัั:
```bash
docker-compose -f docker-compose.node.yml up -d
```

## ะะพะฝัะธะณััะฐัะธั MTProto

### ะะพัะบะตัั (WORKERS)
- ะะพ ัะผะพะปัะฐะฝะธั: 2
- ะะตะบะพะผะตะฝะดัะตััั: ะบะพะปะธัะตััะฒะพ CPU ัะดะตั
- ะะฐะถะดัะน ะฒะพัะบะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะพ 60,000 ะฟะพะดะบะปััะตะฝะธะน

### NAT ะธ ะดะพะผะตะฝั
ะัะธ ัะฐะฑะพัะต ะทะฐ NAT ั ะดะพะผะตะฝะพะผ ะธัะฟะพะปัะทัะตััั ัะปะฐะณ `--nat-info`:
```bash
--nat-info <internal_ip>:<external_domain>
```

### ะกะตะบัะตัั
- ะะฑััะฝัะน ัะตะบัะตั: 16 ะฑะฐะนั hex (32 ัะธะผะฒะพะปะฐ)
- ะก Fake-TLS: ะดะพะฑะฐะฒะธัั ะฟัะตัะธะบั `dd`
- ะะพะถะฝะพ ัะบะฐะทะฐัั ะฝะตัะบะพะปัะบะพ ัะตัะตะท ะทะฐะฟัััั

## ะะตะทะพะฟะฐัะฝะพััั

### mTLS ะผะตะถะดั Control Panel ะธ ะฝะพะดะฐะผะธ
- ะะทะฐะธะผะฝะฐั TLS-ะฐััะตะฝัะธัะธะบะฐัะธั
- ะกะตััะธัะธะบะฐัั ะณะตะฝะตัะธัััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- ะัะพะฒะตัะบะฐ CN ะธ ะฒะฐะปะธะดะฐัะธั ัะตััะธัะธะบะฐัะพะฒ

### ะะปััะตัะฝะฐัะธะฒะฐ: Token Auth
- ะะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั Bearer Token ะฒะผะตััะพ mTLS
- ะขะพะบะตะฝ ะณะตะฝะตัะธััะตััั ะฟัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะดั
- ะะตัะตะดะฐะตััั ะฒ ะทะฐะณะพะปะพะฒะบะต `Authorization`

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
tg-mtproxy/
โโโ control-panel/          # Control Panel (ะณะปะฐะฒะฝัะน ัะตัะฒะตั)
โ   โโโ src/
โ   โ   โโโ bot.ts         # Telegram ะฑะพั
โ   โ   โโโ api.ts         # API ะดะปั ัะฒัะทะธ ั ะฝะพะดะฐะผะธ
โ   โ   โโโ database.ts    # ะะฐะทะฐ ะดะฐะฝะฝัั
โ   โ   โโโ node-client.ts # ะะปะธะตะฝั ะดะปั ะพะฑัะตะฝะธั ั ะฝะพะดะฐะผะธ
โ   โโโ Dockerfile
โ   โโโ docker-compose.yml
โ
โโโ node-agent/            # Node Agent (ัััะฐะฝะฐะฒะปะธะฒะฐะตััั ะฝะฐ ะฝะพะดะฐั)
โ   โโโ src/
โ   โ   โโโ api.ts         # API-ัะตัะฒะตั
โ   โ   โโโ mtproto.ts     # ะฃะฟัะฐะฒะปะตะฝะธะต MTProto
โ   โ   โโโ socks5.ts      # ะฃะฟัะฐะฒะปะตะฝะธะต SOCKS5
โ   โโโ Dockerfile
โ   โโโ docker-compose.node.yml
โ
โโโ scripts/               # ะกะบัะธะฟัั ะดะปั ัััะฐะฝะพะฒะบะธ
โ   โโโ setup-control.sh
โ   โโโ setup-node.sh
โ
โโโ certs/                 # mTLS ัะตััะธัะธะบะฐัั
    โโโ generate.sh
```

## ะะพะฝะธัะพัะธะฝะณ

### MTProto ััะฐัะธััะธะบะฐ
ะะพัััะฟะฝะฐ ัะตัะตะท `http://localhost:2398/stats`:
- `ready_targets` - ัะตัะฒะตัั Telegram
- `active_targets` - ะฐะบัะธะฒะฝัะต ะฟะพะดะบะปััะตะฝะธั ะบ Telegram
- `total_special_connections` - ะฟะพะดะบะปััะตะฝะธั ะบะปะธะตะฝัะพะฒ
- `total_max_special_connections` - ะผะฐะบัะธะผัะผ (60000 * workers)

### Node Agent API
Endpoints:
- `GET /health` - ะทะดะพัะพะฒัะต ะฝะพะดั
- `GET /stats` - ััะฐัะธััะธะบะฐ ะฟัะพะบัะธ
- `POST /restart` - ะฟะตัะตะทะฐะฟััะบ
- `POST /add-secret` - ะดะพะฑะฐะฒะธัั ัะตะบัะตั
- `DELETE /remove-secret` - ัะดะฐะปะธัั ัะตะบัะตั

## FAQ

**Q: ะกะบะพะปัะบะพ ะฒะพัะบะตัะพะฒ ะฝัะถะฝะพ?**
A: ะะตะบะพะผะตะฝะดัะตััั ะฟะพ ะบะพะปะธัะตััะฒั CPU ัะดะตั. ะะดะธะฝ ะฒะพัะบะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะพ 60,000 ะฟะพะดะบะปััะตะฝะธะน.

**Q: ะะฐะบ ัะฐะฑะพัะฐะตั ะดะพะผะตะฝ ะฒะผะตััะพ IP?**
A: ะัะฟะพะปัะทัะตััั ัะปะฐะณ `--nat-info`, ะบะพัะพััะน ะดะตะปะฐะตั mapping ะผะตะถะดั ะฒะฝัััะตะฝะฝะธะผ IP ะธ ะฒะฝะตัะฝะธะผ ะดะพะผะตะฝะพะผ.

**Q: ะะฐัะตะผ ััะธ ัะธะฟะฐ ะฟัะพะบัะธ?**
A: 
- MTProto dd - ะดะปั ะพะฑัะพะดะฐ DPI (Deep Packet Inspection)
- MTProto ะพะฑััะฝัะน - ะฑััััะตะต, ะฝะพ ะผะพะถะตั ะฑะปะพะบะธัะพะฒะฐัััั
- SOCKS5 - ัะฝะธะฒะตััะฐะปัะฝัะน, ัะฐะฑะพัะฐะตั ะดะปั ะฒัะตั ะฟัะธะปะพะถะตะฝะธะน

**Q: ะะฐะบ ัะฐััะพ ะพะฑะฝะพะฒะปััั proxy-secret ะธ proxy-multi.conf?**
A: Telegram ัะตะบะพะผะตะฝะดัะตั ะพะฑะฝะพะฒะปััั ัะฐะท ะฒ ะดะตะฝั. Node Agent ะดะตะปะฐะตั ััะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ.

## Roadmap

- [ ] Web-ะฟะฐะฝะตะปั ะดะปั ัะฟัะฐะฒะปะตะฝะธั
- [ ] ะะฒัะพะผะฐัะธัะตัะบะธะน failover ะผะตะถะดั ะฝะพะดะฐะผะธ
- [ ] Load balancing
- [ ] Prometheus ะผะตััะธะบะธ
- [ ] Grafana ะดะฐัะฑะพัะดั
- [ ] ะะฒัะพะผะฐัะธัะตัะบะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะพะด ัะตัะตะท Ansible
