# SOCKS5 Fix - –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏:
1. ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SOCKS5 –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ - –±–æ—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
2. ‚ùå Node-agent –Ω–µ –≤–∏–¥–µ–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è - `updateSocks5Config()` –ø—ã—Ç–∞–ª—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å docker-compose.yml
3. ‚ùå –ö–æ–º–∞–Ω–¥–∞ `/add_socks5` —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è SOCKS5 (control-panel/src/bot.ts)
```typescript
// –¢–µ–ø–µ—Ä—å –±–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å username –∏ password
if (state.action === 'add_socks5') {
  // –ü–∞—Ä—Å–∏—Ç username: xxx –∏ password: yyy
  // –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –ë–î
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ node-agent —á–µ—Ä–µ–∑ API
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç deep link —Å –∫–Ω–æ–ø–∫–æ–π
}
```

### 2. –£–ø—Ä–æ—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è updateSocks5Config() (node-agent/src/api.ts)
```typescript
// –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è: –ø—ã—Ç–∞–ª–∞—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å docker-compose.yml (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ)
// –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: –Ω–∞–ø—Ä—è–º—É—é —É–ø—Ä–∞–≤–ª—è–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
async function updateSocks5Config(accounts) {
  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  execSync('docker stop mtproxy-socks5 || true');
  execSync('docker rm mtproxy-socks5 || true');
  
  // –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –Ω–æ–≤—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
  const authStrings = accounts.map(acc => `${acc.username}:${acc.password}`).join(',');
  const gostArg = `-L=socks5://${authStrings}@:1080`;
  
  docker run -d --name=mtproxy-socks5 \
    -p 1080:1080 \
    ginuerzh/gost ${gostArg}
}
```

### 3. –£–¥–∞–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /add_socks5
- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ "‚ûï SOCKS5" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –î–∏–∞–ª–æ–≥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç username –∏ password
- –ë–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π UX

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /root/eeee  # –∏–ª–∏ –≥–¥–µ —É –≤–∞—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git pull origin master

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã
docker compose build

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker compose down
docker compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs -f mtproxy-control-panel
docker logs -f mtproxy-node-agent

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker ps
```

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SOCKS5:

1. **–í –±–æ—Ç–µ:**
   - –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞
   - –í—ã–±—Ä–∞—Ç—å "üîó –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏"
   - –í—ã–±—Ä–∞—Ç—å –Ω–æ–¥—É
   - –ù–∞–∂–∞—Ç—å "‚ûï SOCKS5"
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç:
     ```
     username: testuser
     password: testpass123
     ```
   - –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏"

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–æ–¥–µ:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
   docker ps | grep socks5
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
   docker logs mtproxy-socks5
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
   cat /root/mtproxy/node-agent/data/socks5-users.json
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   # –° —Å–µ—Ä–≤–µ—Ä–∞
   curl -x socks5://testuser:testpass123@localhost:1080 https://ifconfig.me
   
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Telegram:**
   - –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏" –≤ –±–æ—Ç–µ
   - Telegram –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```bash
# Control Panel (–±–æ—Ç)
docker logs mtproxy-control-panel | grep -i socks5

# Node Agent (API)
docker logs mtproxy-node-agent | grep -i socks5

# SOCKS5 container
docker logs mtproxy-socks5

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker inspect mtproxy-node-agent | grep -i socks5
```

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker logs mtproxy-control-panel`
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

2. **Node-agent –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –¥–æ—Å—Ç—É–ø–µ–Ω: `curl -H "Authorization: Bearer YOUR_TOKEN" http://node-ip:3000/health`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker logs mtproxy-node-agent`

3. **SOCKS5 –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç: `netstat -tulpn | grep 1080`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker ps | grep socks5`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é: `curl -x socks5://user:pass@localhost:1080 https://ifconfig.me`

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `control-panel/src/bot.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è add_socks5
- ‚úÖ `node-agent/src/api.ts` - —É–ø—Ä–æ—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è updateSocks5Config()

Commit: a8a3d6f
