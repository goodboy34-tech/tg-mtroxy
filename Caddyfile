# Caddyfile для автоматического HTTPS
# 
# ИНСТРУКЦИЯ:
# 1. Замените example.com на ваш домен в строке ниже
# 2. Если домен указан - Caddy автоматически получит SSL сертификат от Let's Encrypt
# 3. Если используете localhost - закомментируйте строку с доменом и раскомментируйте блок localhost

# Для продакшена - укажите ваш домен:
3ctpsipkgzwm4eca.ookcdn.ru {
    # Логирование
    log {
        output file /var/log/caddy/access.log
        format json
    }
    
    # Логи ошибок
    log {
        output file /var/log/caddy/error.log
        level ERROR
    }

    # Remnawave API webhook'и
    handle /api/remnawave/* {
        reverse_proxy mtproxy-control:8081 {
            # Передаем все заголовки для webhook аутентификации
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-Host {host}
        }
    }

    # Web API
    handle /api/web/* {
        reverse_proxy mtproxy-control:8082
    }

    # Все остальные запросы проксируем на Remnawave API
    handle {
        reverse_proxy mtproxy-control:8081
    }
}

# Для разработки (localhost) - раскомментируйте блок ниже и закомментируйте блок выше:
# localhost {
#     # Remnawave API webhook'и
#     handle /api/remnawave/* {
#         reverse_proxy mtproxy-control:8081
#     }
# 
#     # Web API
#     handle /api/web/* {
#         reverse_proxy mtproxy-control:8082
#     }
# 
#     # Все остальные запросы
#     handle {
#         reverse_proxy mtproxy-control:8081
#     }
# }
